#!/bin/bash

# Prompt the user to select the .nexsrc file
NEXSRC_FILE=$(zenity --file-selection --title="Select a .nexsrc File")
if [ -z "$NEXSRC_FILE" ]; then
  zenity --error --text="No file selected. Exiting."
  exit 1
fi

# Validate that the selected file exists
if [ ! -f "$NEXSRC_FILE" ]; then
  zenity --error --text="The selected file does not exist."
  exit 1
fi

# Prompt the user to select the script to run after conversion
RUN_FILE=$(zenity --file-selection --title="Select the Script to Run After Conversion")
if [ -z "$RUN_FILE" ]; then
  zenity --error --text="No file selected. Exiting."
  exit 1
fi

# Extract the directory and base name of the .nexsrc file
FILE_DIR=$(dirname "$NEXSRC_FILE")
BASE_NAME=$(basename "$NEXSRC_FILE" .nexsrc)

# Define output file paths
NEXS_FILE="$FILE_DIR/$BASE_NAME.nexs"
JS_FILE="$FILE_DIR/$BASE_NAME.js"

# Simulate .nexsrc to .nexs conversion
zenity --info --text="Converting $NEXSRC_FILE to $NEXS_FILE..."
cp "$NEXSRC_FILE" "$NEXS_FILE" || {
  zenity --error --text="Error during .nexsrc to .nexs conversion."
  exit 1
}

# Simulate .nexs to .js conversion
zenity --info --text="Converting $NEXS_FILE to $JS_FILE..."
cp "$NEXS_FILE" "$JS_FILE" || {
  zenity --error --text="Error during .nexs to .js conversion."
  exit 1
}

# Run the selected script
zenity --info --text="Running $RUN_FILE..."
bash "$RUN_FILE" || {
  zenity --error --text="Error running the selected script."
  exit 1
}

zenity --info --text="Process completed successfully!"